---
- name: Configurer et monter un nouveau disque sur Ubuntu
  hosts: votre_hote
  become: true
  tasks:
    - name: Partitionner le disque
      parted:
        device: /dev/sdb
        number: 1
        state: present
      register: disk_partition_result

    - name: Créer un système de fichiers ext3
      filesystem:
        fstype: ext3
        dev: /dev/sdb1
      when: disk_partition_result.changed

    - name: Créer le répertoire de montage
      file:
        path: /chemin/vers/votre/point/de/montage
        state: directory

    - name: Monter le disque
      mount:
        path: /chemin/vers/votre/point/de/montage
        src: /dev/sdb1
        fstype: ext3
        state: mounted


---
- name: Installer et configurer le serveur NFS
  hosts: votre_hote
  become: true
  tasks:
    - name: Installer le serveur NFS
      apt:
        name: nfs-kernel-server
        state: present

    - name: Créer le répertoire d'export NFS
      file:
        path: /chemin/vers/repertoire/export
        state: directory

    - name: Configurer les exportations NFS
      lineinfile:
        path: /etc/exports
        line: "/chemin/vers/repertoire/export IP1(rw,sync,no_subtree_check) IP2(rw,sync,no_subtree_check)"
        state: present
      notify: Redémarrer le serveur NFS

  handlers:
    - name: Redémarrer le serveur NFS
      systemd:
        name: nfs-kernel-server
        state: restarted

